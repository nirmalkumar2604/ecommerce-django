{% extends "e-com/base.html" %}
{% block title %}My Orders | NK Mart{% endblock %}

{% block content %}
<div class="orders-container">
  <h2 class="section-title">ðŸ“¦ My Orders</h2>
  <div id="orderList" class="order-list"></div>
</div>

<script>
async function loadOrders() {
  const email = prompt("Enter your registered email:");
  if (!email) return alert("âŒ Email is required to view your orders.");

  const res = await fetch(`/api/view_orders/?email=${email}`);
  const data = await res.json();

  const container = document.getElementById("orderList");
  container.innerHTML = "";

  if (res.ok && data.orders && data.orders.length > 0) {
    data.orders.forEach((order) => {
      const div = document.createElement("div");
      div.classList.add("order-card");
      div.innerHTML = `
        <h3>Order #${order.id}</h3>
        <p><strong>Date:</strong> ${new Date(order.created_at).toLocaleDateString()}</p>
        <p><strong>Status:</strong> ${order.status}</p>
        <p><strong>Total:</strong> â‚¹${order.total_price}</p>
        <button onclick="viewOrder('${order.id}')">View Details</button>
      `;
      container.appendChild(div);
    });
  } else {
    container.innerHTML = "<p class='no-products'>No orders found.</p>";
  }
}

function viewOrder(id) {
  window.location.href = `/ui/order_detail/?id=${id}`;
}

loadOrders();
</script>
{% endblock %}
